---
phase: 05-deployment-testing
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - commercial/index.html
  - residential/index.html
autonomous: true

must_haves:
  truths:
    - "Commercial site scores 90+ on Lighthouse Performance (mobile and desktop)"
    - "Residential site scores 90+ on Lighthouse Performance (mobile and desktop)"
    - "LCP (Largest Contentful Paint) is under 2.5s on mobile"
    - "No render-blocking resources delaying page load"
  artifacts:
    - path: ".planning/phases/05-deployment-testing/lighthouse-commercial-mobile.html"
      provides: "Commercial mobile performance report"
      min_lines: 10
    - path: ".planning/phases/05-deployment-testing/lighthouse-residential-mobile.html"
      provides: "Residential mobile performance report"
      min_lines: 10
  key_links:
    - from: "Hero image"
      to: "LCP metric"
      via: "fetchpriority attribute"
      pattern: 'fetchpriority="high"'
    - from: "CDN scripts"
      to: "TBT metric"
      via: "defer attribute"
      pattern: 'defer'
---

<objective>
Achieve 90+ Lighthouse Performance scores on both sites (mobile and desktop) by optimizing images, fonts, and scripts based on audit results.

Purpose: Ensure both demo sites load fast and feel premium - critical for making a strong first impression on the client.
Output: Lighthouse reports showing 90+ Performance scores and optimized HTML files with performance improvements.
</objective>

<execution_context>
@/Users/dillonhippensteel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dillonhippensteel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/dillonhippensteel/clients/angies-custom-cleaning/.planning/PROJECT.md
@/Users/dillonhippensteel/clients/angies-custom-cleaning/.planning/ROADMAP.md
@/Users/dillonhippensteel/clients/angies-custom-cleaning/.planning/STATE.md
@/Users/dillonhippensteel/clients/angies-custom-cleaning/.planning/phases/05-deployment-testing/05-RESEARCH.md
@/Users/dillonhippensteel/clients/angies-custom-cleaning/.planning/phases/05-deployment-testing/DEPLOYMENT-URLS.md
</context>

<tasks>

<task type="auto">
  <name>Run Lighthouse audits on both sites</name>
  <files>
    .planning/phases/05-deployment-testing/lighthouse-commercial-mobile.html
    .planning/phases/05-deployment-testing/lighthouse-commercial-desktop.html
    .planning/phases/05-deployment-testing/lighthouse-residential-mobile.html
    .planning/phases/05-deployment-testing/lighthouse-residential-desktop.html
  </files>
  <action>
    Run Lighthouse Performance audits on both deployed sites in mobile and desktop modes.

    Install Lighthouse CLI if needed:
    npm install -g lighthouse

    Run audits:
    1. Commercial mobile:
       lighthouse https://angies-commercial-cleaning.vercel.app --output=html --output-path=.planning/phases/05-deployment-testing/lighthouse-commercial-mobile.html --only-categories=performance

    2. Commercial desktop:
       lighthouse https://angies-commercial-cleaning.vercel.app --output=html --output-path=.planning/phases/05-deployment-testing/lighthouse-commercial-desktop.html --only-categories=performance --preset=desktop

    3. Residential mobile:
       lighthouse https://angies-residential-cleaning.vercel.app --output=html --output-path=.planning/phases/05-deployment-testing/lighthouse-residential-mobile.html --only-categories=performance

    4. Residential desktop:
       lighthouse https://angies-residential-cleaning.vercel.app --output=html --output-path=.planning/phases/05-deployment-testing/lighthouse-residential-desktop.html --only-categories=performance --preset=desktop

    Review each report and identify:
    - Current Performance score
    - LCP (Largest Contentful Paint) - should be <2.5s mobile, <1.2s desktop
    - TBT (Total Blocking Time) - should be <300ms
    - CLS (Cumulative Layout Shift) - should be <0.1
    - Opportunities (biggest file size savings)
    - Diagnostics (issues affecting performance)
  </action>
  <verify>
    ls .planning/phases/05-deployment-testing/lighthouse-*.html shows 4 report files
    Each report file is valid HTML (not empty or error)
  </verify>
  <done>
    Four Lighthouse reports exist showing current Performance scores and specific optimization recommendations
  </done>
</task>

<task type="auto">
  <name>Optimize based on Lighthouse recommendations</name>
  <files>
    commercial/index.html
    residential/index.html
  </files>
  <action>
    Apply performance optimizations to both sites based on Lighthouse audit results.

    Common optimizations (apply to both sites):

    1. **Optimize LCP image (hero):**
       - Add fetchpriority="high" to hero image
       - Add width and height attributes to prevent layout shift
       - Ensure hero image is WebP format

       Example:
       ```html
       <img src="images/hero.webp" alt="..." fetchpriority="high" width="1200" height="600">
       ```

    2. **Defer non-critical scripts:**
       - Add defer attribute to AOS and CountUp.js scripts
       - Scripts already loaded via CDN, just need defer attribute

       Example:
       ```html
       <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js" defer></script>
       <script src="https://cdn.jsdelivr.net/npm/countup.js@2.8.0/dist/countUp.min.js" defer></script>
       ```

    3. **Lazy load below-fold images:**
       - Add loading="lazy" to all images below the fold (services, testimonials, etc.)
       - Do NOT lazy load hero image (it's LCP)

       Example:
       ```html
       <img src="images/service.webp" alt="..." loading="lazy" width="400" height="300">
       ```

    4. **Add width/height to all images:**
       - Prevents CLS (layout shift) when images load
       - Use actual image dimensions

    5. **Preconnect to CDN origins (if not already present):**
       ```html
       <link rel="preconnect" href="https://cdnjs.cloudflare.com">
       <link rel="preconnect" href="https://cdn.jsdelivr.net">
       ```

    Apply these optimizations to BOTH commercial/index.html and residential/index.html.

    After optimizations:
    - git add commercial/index.html residential/index.html
    - git commit -m "perf(05-02): optimize for Lighthouse Performance scores"
    - Redeploy both sites: cd commercial && vercel --prod, cd residential && vercel --prod
  </action>
  <verify>
    grep 'fetchpriority="high"' commercial/index.html shows hero image optimization
    grep 'fetchpriority="high"' residential/index.html shows hero image optimization
    grep 'loading="lazy"' commercial/index.html shows below-fold lazy loading
    grep 'defer' commercial/index.html shows deferred scripts
  </verify>
  <done>
    Both index.html files have performance optimizations applied, committed to git, and redeployed to Vercel
  </done>
</task>

<task type="auto">
  <name>Re-run Lighthouse audits and verify 90+ scores</name>
  <files>
    .planning/phases/05-deployment-testing/lighthouse-commercial-mobile-final.html
    .planning/phases/05-deployment-testing/lighthouse-residential-mobile-final.html
    .planning/phases/05-deployment-testing/LIGHTHOUSE-SUMMARY.md
  </files>
  <action>
    Re-run Lighthouse audits after optimizations to verify 90+ Performance scores.

    Run final audits:
    1. lighthouse https://angies-commercial-cleaning.vercel.app --output=html --output-path=.planning/phases/05-deployment-testing/lighthouse-commercial-mobile-final.html --only-categories=performance

    2. lighthouse https://angies-residential-cleaning.vercel.app --output=html --output-path=.planning/phases/05-deployment-testing/lighthouse-residential-mobile-final.html --only-categories=performance

    Extract scores and create LIGHTHOUSE-SUMMARY.md with:
    - Commercial mobile score (before/after)
    - Commercial desktop score (before/after)
    - Residential mobile score (before/after)
    - Residential desktop score (before/after)
    - LCP, TBT, CLS metrics for each
    - Optimizations applied
    - Notes on any remaining opportunities

    If scores are below 90:
    - Review remaining Opportunities in Lighthouse report
    - Apply additional optimizations (compress images further, remove unused CSS, etc.)
    - Re-run audit

    Goal: Both sites 90+ on mobile and desktop Performance.
  </action>
  <verify>
    cat .planning/phases/05-deployment-testing/LIGHTHOUSE-SUMMARY.md shows all 4 scores
    All Performance scores >= 90
  </verify>
  <done>
    Both sites score 90+ on Lighthouse Performance (mobile and desktop) with documented metrics in LIGHTHOUSE-SUMMARY.md
  </done>
</task>

</tasks>

<verification>
Run these checks to confirm optimization success:

1. **Lighthouse scores:**
   - Commercial mobile >= 90
   - Commercial desktop >= 90
   - Residential mobile >= 90
   - Residential desktop >= 90

2. **Core Web Vitals:**
   - LCP < 2.5s (mobile)
   - TBT < 300ms
   - CLS < 0.1

3. **Optimizations applied:**
   - Hero images have fetchpriority="high"
   - Below-fold images have loading="lazy"
   - All images have width/height attributes
   - Scripts have defer attribute
   - Preconnect to CDN origins present

4. **Documentation:**
   - Lighthouse reports saved to .planning/phases/05-deployment-testing/
   - LIGHTHOUSE-SUMMARY.md documents all scores
</verification>

<success_criteria>
- [ ] Four initial Lighthouse reports generated (before optimization)
- [ ] Performance optimizations applied to both index.html files
- [ ] Optimizations committed to git and redeployed to Vercel
- [ ] Final Lighthouse audits show 90+ Performance scores on both sites
- [ ] LCP under 2.5s on mobile for both sites
- [ ] LIGHTHOUSE-SUMMARY.md documents all scores and optimizations
</success_criteria>

<output>
After completion, create `.planning/phases/05-deployment-testing/05-02-SUMMARY.md`
</output>
